&lt;![CDATA[<p>The major project I am currently working on requires many tables to be created in several copies of an SQL Server database in multiple offices. All of these tables need very similar views and stored procedures. There usually are two views per table, one to show all the records, and one to show the records 'WHERE deleted = 0'. I never delete any information in this database, it just gets hidden. There also at least three stored procedures per table, two for synchronisation with other databases, and the other for inserting new records. Quite obviously this becomes tedious quickly. I couldn't find much on the web that suited my exact requirements and I was feeling too lazy to develop my own software. The answer is a very nice combo of XML, XSL, and a command line transformation tool kindly provided by Microsoft in the form of MSXSL.EXE.</p>
<p dir="ltr">Firstly I define any new tables I want to create in a fairly straight forward XML layout. For example:</p>
<blockquote>
<p dir="ltr">&lt;table name="locations"&gt;<br />&nbsp;&lt;field name="deleted" type="bit" nullable="false" id="deleted" /&gt;<br />&nbsp;&lt;field name="lastRevision" type="lastRevisionType" nullable="false" /&gt;<br />&nbsp;&lt;field name="number" type="int" nullable="false" id="pk"&gt;<br />&nbsp; &lt;constraint type="primaryKey" /&gt;<br />&nbsp;&lt;/field&gt;<br />&nbsp;&lt;field name="suburb" type="varchar" size="64" nullable="false" /&gt;<br />&nbsp;&lt;field name="state" type="varchar" size="4" nullable="false" /&gt;<br />&nbsp;&lt;field name="postCode" type="varchar" size="4" nullable="false" /&gt;<br />&nbsp;&lt;field name="freightZone" type="int" nullable="false"&gt;<br />&nbsp; &lt;constraint type="foreignKey" foreignTableName="freightZones" foreignFieldName="number" /&gt;<br />&nbsp;&lt;/field&gt;<br />&lt;/table&gt;</p></blockquote>
<p dir="ltr">Secondly I use some rather fine tuned XSL scripts and a neat batch file to call MSXSL with the appropriate parameters to output the CREATE TABLE SQL, and the SQL for all the views and stored procedures into a file ready to be pasted into Query Analyzer. As you can see, the XML layout is very easy to understand and it would be equally easy to export this layout for existing tables in almost any database or to use this layout to generate any SQL or perhaps even documentation, diagrams, .NET classes or .NET Windows Forms with all the needed controls.</p>
<p>The tricky part in using XSL to generate SQL is getting commas between all fields except the last and, even more so, getting the whitespace output neatly. Fortunately I was cunning enough to ask a markup-wizard colleague of mine to do most of the XSL work for me. It was greatly appreciated as I only had to add the finishing touches and didn't need to read the W3C's XSL specs again. Admittedly, I kept the transformations simple. If I need to define a table with a multi-field primary key then I will need to adjust the resulting SQL before I use it. This happens rarely and is still easier than doing it all manually. There are probably other situations that cause the XSL to fall over but I haven't encountered them yet.</p>
<p>For anyone who has used similar techniques before or decides to try it now, I would like to hear some of your experiences. Here is an example of one of the XSL scripts to get you started:</p>
<blockquote>
<p>&lt;?xml version="1.0" encoding="iso-8859-1" ?&gt;<br />&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</a>" version="1.0"&gt;<br />&nbsp;&lt;xsl:output method="text" encoding="iso-8859-1" indent="no" /&gt;<br />&nbsp;&lt;xsl:strip-space elements="*" /&gt;<br />&nbsp;<br />&nbsp;&lt;xsl:template match="table"&gt;<br />CREATE VIEW dbo.vw_&lt;xsl:value-of select="@name" /&gt; AS<br />SELECT<br />&lt;xsl:for-each select="field[not(@id='deleted')]"&gt;<br />&nbsp;&lt;xsl:text&gt; &lt;/xsl:text&gt;<br />&nbsp;&lt;xsl:value-of select="@name"/&gt;<br />&nbsp;&lt;xsl:if test="position() &amp;lt; last()"&gt;&lt;xsl:text&gt;,&#010;&lt;/xsl:text&gt;&lt;/xsl:if&gt;<br />&lt;/xsl:for-each&gt;<br />FROM dbo.tb_&lt;xsl:value-of select="@name" /&gt;<br />WHERE<br />&lt;xsl:for-each select="field[@id='deleted']"&gt;<br />&nbsp;&lt;xsl:text&gt; &lt;/xsl:text&gt;<br />&nbsp;&lt;xsl:if test="position() &amp;gt; 1"&gt;&lt;xsl:text&gt;AND &lt;/xsl:text&gt;&lt;/xsl:if&gt;<br />&nbsp;&lt;xsl:value-of select="@name"/&gt;<br />&nbsp;&lt;xsl:text&gt; = 0&lt;/xsl:text&gt;<br />&lt;/xsl:for-each&gt;<br />GO</p>
<p>GRANT SELECT ON dbo.vw_&lt;xsl:value-of select="@name" /&gt; TO sales, visitors<br />GO<br />&nbsp;&lt;/xsl:template&gt;<br />&nbsp; <br />&lt;/xsl:stylesheet&gt;<br /></p></blockquote>]]&gt;