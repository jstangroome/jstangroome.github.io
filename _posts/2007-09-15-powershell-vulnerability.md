---
layout: post
permalink: http://blog.stangroome.com/?p=55
title: PowerShell Vulnerability
description: None
date: 2007-09-14 14:47:45 -0000
last_modified_at: 2007-09-14 14:47:45 -0000
publish: false
pin: false
categories:
- Uncategorized
tags: []
---
[Some time ago](http://www.codeassassin.com/blog/PermaLink,guid,dfb78f6d-1e1f-48ea-85e3-443777d7ada6.aspx) I put together a template for a file that can be interpreted as both a batch command script for cmd.exe and a SQL script for SQL Server Management Studio and sqlcmd.exe. It works really well for enabling someone unfamiliar with SQL Server to deploy database update scripts.

I've been working with PowerShell quite a lot lately and I was wondering if it would be possible to have a file that would be interpreted by both cmd.exe and PowerShell.exe. It turns out that Jay Bazuzi, a developer at Microsoft, has already found [an elegant solution](http://blogs.msdn.com/jaybaz_ms/archive/2007/04/26/powershell-polyglot.aspx). However, upon inspecting the code I became concerned how it would be effected by PowerShell's default setting to disable all scripts and especially disable unsigned scripts from remote sources.

I have since worked with Jay's sample on my home machine and discovered that it effectively bypasses PowerShell's anti-script security by piping the commands to it's interactive mode. As a result, it was relatively trivial to write a batch command script that would enable PowerShell to run all future scripts and modify the user's PowerShell profile to ensure it stays that way.

Thankfully, security in the OS and other applications is making it harder to get a command script on to another computer and get the user to run it but with the capabilities of PowerShell potentially available for malicious use it's just one more reason to not run as an administrator and minimise the damage.
